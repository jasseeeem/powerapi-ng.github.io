<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PowerAPI</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="quickstart.html">Quickstart</a></li><li class="chapter-item expanded affix "><li class="part-title">Concepts</li><li class="chapter-item expanded "><a href="reports.html"><strong aria-hidden="true">1.</strong> Reports</a></li><li class="chapter-item expanded affix "><li class="part-title">How to guide</li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">2.</strong> Configuration files</a></li><li class="chapter-item expanded "><a href="grafana.html"><strong aria-hidden="true">3.</strong> Visualize in grafana</a></li><li class="chapter-item expanded "><a href="cgroup.html"><strong aria-hidden="true">4.</strong> Create cgroup</a></li><li class="chapter-item expanded affix "><li class="part-title">What to use ?</li><li class="chapter-item expanded "><a href="what_to_use.html"><strong aria-hidden="true">5.</strong> What to use</a></li><li class="chapter-item expanded affix "><li class="part-title">Monitoring tools</li><li class="chapter-item expanded "><a href="rapl.html"><strong aria-hidden="true">6.</strong> RAPL</a></li><li class="chapter-item expanded "><a href="smartwatts.html"><strong aria-hidden="true">7.</strong> SmartWatts</a></li><li class="chapter-item expanded "><a href="jouleit.html"><strong aria-hidden="true">8.</strong> Jouleit</a></li><li class="chapter-item expanded "><a href="virtualwatts.html"><strong aria-hidden="true">9.</strong> VirtualWatts</a></li><li class="chapter-item expanded affix "><li class="part-title">Sensors</li><li class="chapter-item expanded "><a href="hwpc-sensor.html"><strong aria-hidden="true">10.</strong> Hwpc-Sensor</a></li><li class="chapter-item expanded "><a href="procfs-sensor.html"><strong aria-hidden="true">11.</strong> Procfs-Sensor</a></li><li class="chapter-item expanded affix "><li class="part-title">Database</li><li class="chapter-item expanded "><a href="database.html"><strong aria-hidden="true">12.</strong> Database</a></li><li class="chapter-item expanded affix "><li class="part-title">PowerAPI</li><li class="chapter-item expanded "><a href="powerapi.html"><strong aria-hidden="true">13.</strong> PowerAPI</a></li><li class="chapter-item expanded affix "><li class="part-title">FAQ</li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">PowerAPI</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p><img
src="https://rawgit.com/Spirals-Team/powerapi/master/resources/logo/PowerAPI-logo.png"
alt="Powerapi" width="1000px"></p>
<p>The goal of this projet is to provide a set of tools to go forward a greener
computing.
The idea is to provide software-defined power meters to mesure the power
consumption of program.
The core of this project is the <a href="./powerapi.html">PowerAPI</a> toolkit for building
such power meters.</p>
<h1 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h1>
<p>If you want to monitor the energy consumption of your process we have some
ready-to-use tools</p>
<ul>
<li><a href="./rapl.html">RAPL formula</a> for monitoring the energy consumption of your device.</li>
<li><a href="./smartwatts.html">SmartWatts formula</a> for monitoring the energy consumption of
your process.</li>
<li><a href="./jouleit.html">Jouleit</a> for mesuring the energy consumption of a program.</li>
</ul>
<!-- If you want to develop your own power meter, we encourage you to read about [software-defined power -->
<!-- meters](powerapi_howitworks.md) before starting. -->
<!-- We provide a [quickstart](./powerapi_quickstart.md) project to develop a first -->
<!-- basic formula with powerAPI. -->
<!-- We also provide additional resources for developing your own formula afterward : -->
<!-- - A [User guide](./powerapi_user_guide.md). -->
<!-- - The [API](./powerapi_api.md). -->
<h1 id="how-it-works"><a class="header" href="#how-it-works">How it works</a></h1>
<p>A power meter is an application build with the PowerAPI components that can
measure the power consumption of software running on a single machine or on a
cluster of machine.</p>
<p>This section present each PowerAPI component type and how connect them to build a power meter.</p>
<h2 id="power-meter-architecture"><a class="header" href="#power-meter-architecture">Power meter Architecture</a></h2>
<p>A power meter is a set of two components, a sensor and a formula, used to
produce an estimation of the power consumption of a monitored software.</p>
<p>The sensor collects raw data correlated with the power consumption of the
software. The formula is a computational module that use the collected data to
determine power consumption.
Both of them are connected by a database that is used to
transfer information.
The global architecture of a power meter is represented bellow.</p>
<p><img
src="https://raw.githubusercontent.com/powerapi-ng/powerapi-ng.github.io/master/images/powerAPI_archi.png"
alt="Powerapi" width="1000px"></p>
<p>The two next sub-sections present how a sensor and a formula work and how they
should be used.</p>
<h2 id="sensor"><a class="header" href="#sensor">Sensor</a></h2>
<p>A sensor is an independent software that collects raw data correlated with the
power consumption of monitored software.</p>
<p>Data are collected by querying the hardware’s machine that hosts the monitored
software. The sensor must be executed on the same machine as the monitored
software. The data are collected throughout the duration of the software. For
this reason, the sensor must operate in parallel.</p>
<p>Collected data are stored in an external database to make the data available to
the formula. This database may be hosted on an other machine.</p>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<p>Because they collect from different hardware, each sensor are very different
from one another. Refer to each sensor documentation to know how to use them.</p>
<h2 id="formula"><a class="header" href="#formula">Formula</a></h2>
<p>A formula is an independent software that compute an estimation of the power
consumption of monitored software from the data collected by the sensor.</p>
<h3 id="sensor-connection"><a class="header" href="#sensor-connection">Sensor Connection</a></h3>
<p>A formula communicate with the sensor via a database (e.g MongoDB). The sensor
writes the collected data to the database and the formula reads it afterward.</p>
<p>There are two connection modes:</p>
<ul>
<li>
<p><code>stream</code> mode where the formula read the data from the sensor as they are
produced.</p>
</li>
<li>
<p><code>post-mortem</code> mode which analyses the data already collected by the sensor in a past monitoring phase.</p>
</li>
</ul>
<h1 id="mailing-list"><a class="header" href="#mailing-list">Mailing list</a></h1>
<p>You can follow the latest news and asks questions by subscribing to our <a href="mailto:sympa@inria.fr?subject=subscribe powerapi">mailing list</a>.</p>
<h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<p>If you would like to contribute code you can do so through our <a href="https://github.com/powerapi-ng/">Github
repository</a> by forking it and sending a
pull request.</p>
<p>You should start by reading the <a href="https://github.com/powerapi-ng/powerapi/blob/main/contributing.md">contribution
guide</a></p>
<h1 id="publications"><a class="header" href="#publications">Publications</a></h1>
<ul>
<li><strong><a href="https://hal.inria.fr/hal-01827132v2">The Next 700 CPU Power Models</a></strong>: M. Colmant, R. Rouvoy, M. Kurpicz, A. Sobe, P. Felber, L. Seinturier. <em>Elsevier Journal of Systems and Software</em> (JSS). 144(10):382-396, Elsevier.</li>
<li><strong><a href="https://hal.inria.fr/hal-01439889">WattsKit: Software-Defined Power Monitoring of Distributed Systems</a></strong>: M. Colmant, P. Felber, R. Rouvoy, L. Seinturier. <em>IEEE/ACM International Symposium on Cluster, Cloud and Grid Computing</em> (CCGrid). April 2017, Spain, France. pp.1-14.</li>
<li><strong><a href="https://hal.inria.fr/hal-01130030">Process-level Power Estimation in VM-based Systems</a></strong>: M. Colmant, M. Kurpicz, L. Huertas, R. Rouvoy, P. Felber, A. Sobe. <em>European Conference on Computer Systems</em> (EuroSys). April 2015, Bordeaux, France. pp.1-14.</li>
<li><strong><a href="https://hal.inria.fr/hal-01069142">Monitoring Energy Hotspots in Software</a></strong>: A. Noureddine, R. Rouvoy, L. Seinturier. <em>Journal of Automated Software Engineering</em>, Springer, 2015, pp.1-42.</li>
<li><strong><a href="https://hal.inria.fr/hal-00912613">Unit Testing of Energy Consumption of Software Libraries</a></strong>: A. Noureddine, R. Rouvoy, L. Seinturier. <em>International Symposium On Applied Computing</em> (SAC), March 2014, Gyeongju, South Korea. pp.1200-1205.</li>
<li><strong><a href="http://www.jinnove.com/Actualites/Informatique-des-logiciels-mis-au-vert">Informatique : Des logiciels mis au vert</a></strong>: L. Seinturier, R. Rouvoy. <em>J'innove en Nord Pas de Calais</em>, <a href="http://www.jinnove.com">NFID</a>, 2013.</li>
<li><strong><a href="http://ercim-news.ercim.eu/en92/special/powerapi-a-software-library-to-monitor-the-energy-consumed-at-the-process-level">PowerAPI: A Software Library to Monitor the Energy Consumed at the Process-Level</a></strong>: A. Bourdon, A. Noureddine, R. Rouvoy, L. Seinturier. <em>ERCIM News, Special Theme: Smart Energy Systems</em>, 92, pp.43-44. <a href="http://www.ercim.eu">ERCIM</a>, 2013.</li>
<li><strong><a href="http://www.lifl.fr/digitalAssets/0/807_01info_130110_16_39.pdf">Mesurer la consommation en énergie des logiciels avec précision</a></strong>: A. Bourdon, R. Rouvoy, L. Seinturier. <em>01 Business &amp; Technologies</em>, 2013.</li>
<li><strong><a href="https://hal.inria.fr/hal-00912996v2">A review of energy measurement approaches</a></strong>: A. Noureddine, R. Rouvoy, L. Seinturier. <em>ACM SIGOPS Operating Systems Review</em>, ACM, 2013, 47 (3), pp.42-49.</li>
<li><strong><a href="https://hal.inria.fr/hal-00715331">Runtime Monitoring of Software Energy Hotspots</a></strong>: A. Noureddine, A. Bourdon, R. Rouvoy, L. Seinturier. <em>International Conference on Automated Software Engineering</em> (ASE), September 2012, Essen, Germany. pp.160-169.</li>
<li><strong><a href="https://hal.inria.fr/hal-00681560">A Preliminary Study of the Impact of Software Engineering on GreenIT</a></strong>: A. Noureddine, A. Bourdon, R. Rouvoy, L. Seinturier. <em>International Workshop on Green and Sustainable Software</em> (GREENS), June 2012, Zurich, Switzerland. pp.21-27.</li>
</ul>
<h1 id="credits-and-licence"><a class="header" href="#credits-and-licence">Credits and Licence</a></h1>
<p>PowerAPI is an open-source project developed by the <a href="https://team.inria.fr/spirals">Spirals research group</a> (University of Lille and Inria)</p>
<p>This software is licensed under the BSD 3-Clause License, quoted below.</p>
<blockquote>
<p>BSD 3-Clause License</p>
<p>Copyright (c) 2021, INRIA
Copyright (c) 2021, University of Lille
All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:</p>
<ul>
<li>
<p>Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright notice,
this list of conditions and the following disclaimer in the documentation
and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of the copyright holder nor the names of its
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.</p>
</li>
</ul>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing"><a class="header" href="#installing">Installing</a></h1>
<h2 id="rapl-formula"><a class="header" href="#rapl-formula">RAPL Formula</a></h2>
<p>RAPL Formula is made for tracking the energy consumption of your machine.
To install RAPL Formula run <a href="./script/rapl_install.sh">the following
script</a> in a Terminal.</p>
<p>The script explains what it will do and then pauses before it does it.</p>
<h2 id="jouleit"><a class="header" href="#jouleit">Jouleit</a></h2>
<p>Jouleit is made for tracking the energy consumption of a program.
Jouleit need <code>gawk</code> to run.
You can get the script from the <a href="https://github.com/powerapi-ng/jouleit">github repository</a>
Start jouleit by using <code>./jouleit.sh cmd</code>.</p>
<h2 id="smartwatts"><a class="header" href="#smartwatts">Smartwatts</a></h2>
<p>Smartwatts is made for tracking the energy consumption of processes on a
machine.
To install smartwatts run <a href="./script/smartwatts_install.sh">the following
script</a> in a Terminal.</p>
<p>The script explains what it will do and then pauses before it does it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reports"><a class="header" href="#reports">Reports</a></h1>
<p>PowerAPI tools tend to be modular, any sensor could be plugged to any monitoring
tool as long as the needed information is provided.
We fixed the way of encoding the information. Those encoding are called reports.</p>
<p>A report specify the <code>json</code> fields that should be provided to pass information of
a certain kind.</p>
<p>The type of reports required by each formula are specified in their user guide.</p>
<p>All report have a common basis:</p>
<ul>
<li>
<p><code>timestamp</code> : at the format &quot;year-month-dayThour:minutes:secondes&quot;. The
timestamp should reflect the time at which the information correspond, not the
time the information was computed.
For example if a power consumption of a CPU is mesured at time <code>t</code> and used to
determine the power comsumption of a cgroup in a <code>PowerReport</code>, this report
should have timestamp <code>t</code>.</p>
<ul>
<li><code>target</code> : The target should be the subject of the mesure. For example if
you produce a report that contain information relative to a program,domain,
etc. The target should refer to it.</li>
</ul>
</li>
<li>
<p><code>sensor</code>: It's a name field that should be use to regroup reports for
computing modules. For example, in VirtualWatts, the computationnal module need to receive a
<code>ProcfsReport</code> and a <code>PowerReport</code>, for both reports to be send to the same
computational module they have to have the same <code>sensor</code>.</p>
<p>A report have the following format:</p>
<pre><code class="language-json">&quot;timestamp&quot;:$timestamp,
&quot;target&quot;:$target,
&quot;sensor&quot;:$sensor,
$report_specific_fields

</code></pre>
</li>
</ul>
<p>In the following parts we specify the <code>$report_specific_fields</code> for each type of report.</p>
<h1 id="hwpc-report"><a class="header" href="#hwpc-report">HWPC Report</a></h1>
<p>A <code>HWPCReport</code> should be used to report perfomance counters and RAPL.
It specific fields are the following :</p>
<ul>
<li>
<p><code>groups</code>: A list of subreport that can be of three kind, <code>rapl</code>, <code>core</code> and
<code>msr</code>.</p>
<p>Each are presented the same way</p>
<pre><code class="language-json">{
  $type: {
    $core_number : {
      $socket_number : {
        List of counter and their value
      }
    }
  }
}
</code></pre>
</li>
</ul>
<p>We provide an example of <code>HWPCReport</code>:</p>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2021-01-13T09:51:22.630&quot;,
  &quot;sensor&quot;: &quot;sensor_test&quot;,
  &quot;target&quot;: &quot;influxdb&quot;,
  &quot;groups&quot;: {
    &quot;core&quot;: {
      &quot;0&quot;: {
        &quot;0&quot;: {
          &quot;CPU_CLK_THREAD_UNHALTED:THREAD_P&quot;: 75510,
          &quot;CPU_CLK_THREAD_UNHALTED:REF_P&quot;: 2271,
          &quot;time_enabled&quot;: 167403,
          &quot;time_running&quot;: 167403,
          &quot;LLC_MISSES&quot;: 1077,
          &quot;INSTRUCTIONS_RETIRED&quot;: 31693
        },
        &quot;1&quot;: {
          &quot;CPU_CLK_THREAD_UNHALTED:THREAD_P&quot;: 43801,
          &quot;CPU_CLK_THREAD_UNHALTED:REF_P&quot;: 1318,
          &quot;time_enabled&quot;: 99324,
          &quot;time_running&quot;: 99324,
          &quot;LLC_MISSES&quot;: 750,
          &quot;INSTRUCTIONS_RETIRED&quot;: 15011
        }
      }
    }
  }
}
{
  &quot;timestamp&quot; : &quot;2021-01-13T09:51:22.630&quot;,
  &quot;sensor&quot; : &quot;sensor_test&quot;,
  &quot;target&quot; : &quot;all&quot;,
  &quot;groups&quot; : {
    &quot;rapl&quot; : {
      &quot;0&quot; : {
        &quot;1&quot; : {
			      &quot;RAPL_ENERGY_PKG&quot; : 5709496320,
			      &quot;time_enabled&quot; : 1006717449,
			      &quot;time_running&quot; : 1006717449
          }
      }
    },
    &quot;msr&quot; : {
      &quot;0&quot; : {
        &quot;0&quot; : {
          &quot;MPERF&quot; : 29646849,
	        &quot;APERF&quot; : 12319312,
	        &quot;TSC&quot; : 2122153094,
	        &quot;time_enabled&quot; : 1006580601,
	        &quot;time_running&quot; : 1006580601
        },
        &quot;1&quot; : {
          &quot;MPERF&quot; : 20587012,
          &quot;APERF&quot; : 19838920,
          &quot;TSC&quot; : 2122185970,
	        &quot;time_enabled&quot; : 1006560540,
	        &quot;time_running&quot; : 1006560540
        }
      }
    }
  }
}

</code></pre>
<h1 id="power-report"><a class="header" href="#power-report">Power Report</a></h1>
<p>A <code>PowerReport</code> should be used to transfer information about power consumption.
It specific fields are the following :</p>
<ul>
<li><code>power</code>: A power value in Watts</li>
</ul>
<p>We provide an example of <code>PowerReport</code>:</p>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2021-09-14T12:37:37.168817&quot;,
  &quot;sensor&quot;: &quot;formula_group&quot;,
  &quot;target&quot;: &quot;all&quot;,
  &quot;power&quot;: 42
}
</code></pre>
<h1 id="procfs-report"><a class="header" href="#procfs-report">Procfs Report</a></h1>
<p>A <code>ProcfsReport</code> should be used to transfer information about cpu usage of
process.
It specific fields are the following :</p>
<ul>
<li><code>global_cpu_usage</code> : The used percentage of the cpu.</li>
<li><code>usage</code>: A list of the monitored process with their percentage of cpu usage.</li>
</ul>
<p>We provide an example of <code>ProcfsReport</code>:</p>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2021-09-14T12:37:37.168817&quot;,
  &quot;sensor&quot;: &quot;formula_group&quot;,
  &quot;target&quot;: [&quot;firefox_cgroup&quot;, &quot;emacs_cgroup&quot;, &quot;zsh_cgroup&quot;, &quot;mongo_cgroup&quot;],
  &quot;usage&quot;: {
    &quot;firefox_cgroup&quot;: 8.36,
    &quot;emacs_cgroup&quot;: 5.52,
    &quot;zsh_cgroup&quot;: 0.01,
    &quot;mongo_cgroup&quot;: 0.64
  },
  &quot;global_cpu_usage&quot;: 27.610000000000014
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-file"><a class="header" href="#configuration-file">Configuration File</a></h1>
<p>PowerAPI can read configuration through config file or through the CLI.
Here we are using config file because they are more readable.</p>
<p>PowerAPI can be configured with the following parameters :</p>
<ul>
<li><code>verbose</code> (bool) : verbose or quiet mode.</li>
<li><code>stream</code> (bool) : to specify if the reports are provided one by one or are
stored in a database.</li>
<li><code>sensor-report-sampling-interval</code> (int): If in stream mode, the time in
milliseconds between two reports.</li>
<li><code>input</code> (database) : The database used in input. The way to write their
configuration is specified <a href="./database.html">here</a>. Multiple database can be
used as inputs.</li>
<li><code>output</code> (database) : The database used in output. The way to write their
configuration is specified <a href="./database.html">here</a>. Multiple database can be
used as outputs.</li>
</ul>
<p>All configuration files of PowerAPI based formula follow the next template:</p>
<pre><code class="language-json">{
  &quot;verbose&quot;: $bool,
  &quot;stream&quot;: $bool ,
  &quot;sensor-report-sampling-interval&quot; : $int,
&quot;input&quot;: {
    $puller_name: {
      &quot;model&quot;: $type_of_report,
      &quot;type&quot;: $type_of_database,
      $database_parameters
    }
    ... #(Multiple puller can be used)
  },
  &quot;output&quot;: {
    $pusher_name: {
      &quot;type&quot;: $type_of_database
      $database_parameters
    }
    ... #(Multiple pusher can be used)

  },
  $formula_parameters
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="visualizing-process-power-consumptions-on-grafana"><a class="header" href="#visualizing-process-power-consumptions-on-grafana">Visualizing process power consumptions on Grafana</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>This tutorial presents how to visualize the power estimation computed by a formula on a grafana dashboard to obtain this kind of visualisation:</p>
<p><img
src="https://raw.githubusercontent.com/powerapi-ng/powerapi-ng.github.io/master/images/viz_by_process.png"
alt="datasource_section" width="1000px"></p>
<p>This screenshot show the visualisation of power consumption of a web browser and tools used for monitoring (database, sensor, formula)</p>
<p>In this tutorial, we describe how to connect a formula to a grafana instance, using InfluxDB.
Then, we will see how to configure grafana to visualize the power estimation computed by the formula.</p>
<p>This tutorial assume that you know how launch a formula and a sensor to compute power estimation and that you have an InfluxDB and a grafana instance running on your local machine.
The InfluxDB instance listen on port <code>1234</code> and Grafana instance listen on port <code>4321</code>.</p>
<h2 id="connect-grafana-to-the-influxdb-instance"><a class="header" href="#connect-grafana-to-the-influxdb-instance">Connect Grafana to the InfluxDB instance</a></h2>
<p>Connect to your Grafana instance and go to the &quot;Data sources&quot; section (in the configuration part of the side bar).</p>
<p><img
src="https://raw.githubusercontent.com/powerapi-ng/powerapi-ng.github.io/master/images/grafana_home.png"
alt="datasource_section" width="300px"></p>
<p>Click on the <code>&quot;Add data source&quot;</code> button and select <code>&quot;InfluxDB&quot;</code>.</p>
<p>Enter a data source name (here we choose &quot;InfluxDB-1&quot;), the instance URI (<code>http://localhost:4321</code>) and the database name you use in the file <code>config_formula.json</code> then click on the <code>&quot;Save and test&quot;</code> button.</p>
<p><img
src="https://raw.githubusercontent.com/powerapi-ng/powerapi-ng.github.io/master/images/add_db.png"
alt="datasource_section" width="400px"></p>
<h2 id="visualize-the-power-consumption-on-a-dashboard-in-real-time"><a class="header" href="#visualize-the-power-consumption-on-a-dashboard-in-real-time">Visualize the power consumption on a dashboard in real-time</a></h2>
<p>Go to the <code>&quot;Create Dashboard&quot;</code> section on the side bar to create a new dashboard.</p>
<p><img
src="https://raw.githubusercontent.com/powerapi-ng/powerapi-ng.github.io/master/images/add_dashboard.png"
alt="datasource_section" width="300px"></p>
<p>Click on the <code>&quot;add Query&quot;</code> button and write the following query on the <code>Query</code> field to request the power estimations from the InfluxDB measurement: <code>SELECT power FROM &quot;power_consumption&quot; GROUP BY target</code></p>
<p>Then write <code>$tag_target</code> on the <code>ALIAS BY</code> field to label each graph with the target name</p>
<p><img
src="https://raw.githubusercontent.com/powerapi-ng/powerapi-ng.github.io/master/images/add_query_by_process.png"
alt="datasource_section" width="600px"></p>
<p>To display the power consumption in real time, you can update the range of the visualisation to <code>last 5 minutes</code> and the <code>refresh dashboard</code> parameter to <code>5s</code>. This parameter are on the top-right corner of the UI.</p>
<p><img
src="https://raw.githubusercontent.com/powerapi-ng/powerapi-ng.github.io/master/images/refresh.png"
alt="datasource_section" width="600px"></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-create-a-cgroup"><a class="header" href="#how-to-create-a-cgroup">How to create a cgroup</a></h1>
<p>If you want to monitor a specific process (or group of process), you have to
create a cgroup with <code>perf_event</code> controller and add the process you want to
monitor to this cgroup</p>
<p>You can easly do this with the following command :</p>
<ul>
<li>to create the cgroup : <code>cgcreate -g perf_event:new_cgroup_name</code></li>
</ul>
<p>with <code>new_cgroup_name</code> the name of the cgroup you want to create (this will be the name wich will identify power consumption of you process)</p>
<ul>
<li>to add your process to the newly created cgroup : <code>cgclassify -g perf_event:new_cgroup_name PID</code></li>
</ul>
<p>with <code>PID</code>, the pid of the process you want to monitor. If you want to monitor a
program composed of many process, replace PID with <code>$(pidof program_name)</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-to-use"><a class="header" href="#what-to-use">What to use</a></h1>
<p>We provide a set of ready-to-use tools for diverse needs. We list bellow the
available tools and the main use cases.</p>
<ul>
<li><a href="./rapld.html">RAPL Formula</a> : Mesure of power consumption of each socket.</li>
<li><a href="./smartwatts.html">SmartWatts Formula</a> : Mesure of power consumption of cgroup
(do not work in VM)</li>
<li><a href="./virtualwatts.html">VirtualWatts</a> : Mesure of power consumption of cgroup
inside a VM</li>
<li><a href="./jouleit.html">Jouleit</a>: Mesure the energy consumed by your program</li>
<li><a href="https://github.com/powerapi-ng/joulehunter">Joule Hunter</a> : Mesure energy
consumption of each part of your program.</li>
<li><a href="https://github.com/powerapi-ng/pyJoules">PyJoules</a> : Monitor the energy consumed by specific device of the host machine</li>
</ul>
<p>If you did not find the tools that respond to your needs you should consider
writing it.
We provide a tutorial on how to write a formula <a href="./powerapi.html">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rapl"><a class="header" href="#rapl">RAPL</a></h1>
<p>RAPL stand for Running Average Power Limit, it is a feature of recent intel
processors that provide the energy consumption of the processor.</p>
<p>The RAPL formula is designed to mesure power consumption of domains (cpu or ram)
in real time.</p>
<p>The RAPL formula take HWPC report with RAPL event for each domains. It then
return the mesured power in a PowerReport for each domain.
This formula do not perform any other computation as its goal is only to track
global power consumption in a more readable way than raw RAPL.</p>
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>You can use <a href="./script/rapl_install.sh">the following script</a> to install RAPL Formula and HWPC Sensor.</p>
<h2 id="from-pypi"><a class="header" href="#from-pypi">From pypi</a></h2>
<p><code>pip install rapl-formula</code></p>
<h2 id="from-docker"><a class="header" href="#from-docker">From docker</a></h2>
<p><code>docker pull powerapi/rapl-formula</code></p>
<h2 id="from-deb-file"><a class="header" href="#from-deb-file">From deb file</a></h2>
<p>Download the <code>.deb</code> files (rapl-formula and thespian) from the <a href="https://github.com/powerapi-ng/rapl-formula/releases">latest
release</a></p>
<p>Install rapl-formula with <code>sudo apt install ./python3-rapl-formula_0.5.0-1_all.deb</code></p>
<h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<p>For running the RAPL formula we'll need two things:</p>
<ul>
<li>A sensor that provide HWPCReport. We'll use <a href="./hwpc-sensor.html">HWPC sensor</a>.</li>
<li>A configuration for the formula. We provide an example bellow.</li>
</ul>
<pre><code class="language-json">{
  &quot;verbose&quot;: true,
  &quot;stream&quot;: true,
  &quot;input&quot;: {
    &quot;puller&quot;: {
      &quot;model&quot;: &quot;HWPCReport&quot;,
      &quot;type&quot;: &quot;mongodb&quot;,
      &quot;uri&quot;: &quot;mongodb://127.0.0.1&quot;,
      &quot;db&quot;: &quot;test&quot;,
      &quot;collection&quot;: &quot;prep&quot;
    }
  },
  &quot;output&quot;: {
    &quot;pusher_power&quot;: {
      &quot;type&quot;: &quot;mongodb&quot;,
      &quot;model&quot;: &quot;PowerReport&quot;,
      &quot;type&quot;: &quot;mongodb&quot;,
      &quot;uri&quot;: &quot;mongodb://127.0.0.1&quot;,
      &quot;db&quot;: &quot;test&quot;,
      &quot;collection&quot;: &quot;results&quot;
    }
  },
  &quot;enable-dram-formula&quot;: false,
  &quot;sensor-report-sampling-interval&quot;: 500
}
</code></pre>
<p>Start by installing the hwpc-sensor (see
<a href="./hwpc-sensor.html#installation">here</a>) and start it (see
<a href="./hwpc-sensor.html#quickstart">here</a>).
You also need to start an mongodb via the command line <code>docker run -d --name mongo_rapl -p 27017:27017 mongo</code>.</p>
<p>Then run <code>rapl_formula</code> using one of the following command line, depending on
the installation you used:</p>
<ul>
<li>via pip : <code>python -m rapl_formula --config-file config_file.json</code></li>
<li>via docker <code>docker run -v $(pwd)/config_file.json:/config_file.json powerapi/rapl-formula --config-file /config_file.json </code></li>
<li>via deb file : <code>rapl-formula --config-file config_file.json</code></li>
</ul>
<p>Your power report will be provided in the influxdb. You can watch them in a
grafana using the <a href="./grafana.html">following tutorial</a></p>
<h1 id="user-guide"><a class="header" href="#user-guide">User guide</a></h1>
<h2 id="configuration-parameters"><a class="header" href="#configuration-parameters">Configuration parameters</a></h2>
<ul>
<li><code>enable-cpu-formula</code> (bool) : Enable CPU formula, default=True</li>
<li><code>enable-dram-formula</code>(bool) : Enable DRAM formula, default=True</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="smartwatts-1"><a class="header" href="#smartwatts-1">SmartWatts</a></h1>
<p>SmartWatts is a software-defined power meter based on the PowerAPI toolkit.
SmartWatts is a configurable software that can estimate the power consumption of
software in real-time.
SmartWatts need to receive several metrics provided by
<a href="https://github.com/powerapi-ng/hwpc-sensor">hwpc-sensor</a> :</p>
<ul>
<li>The Running Average Power Limit (RAPL)</li>
<li>TSC</li>
<li>APERF</li>
<li>MPERF</li>
<li>CPU_CLK_THREAD_UNHALTED:REF_P</li>
<li>CPU_CLK_THREAD_UNHALTED:THREAD_P</li>
<li>LLC_MISSES</li>
<li>INSTRUCTIONS_RETIRED</li>
</ul>
<p>These metrics are then used as inputs for a power model that estimate the power
consumption of each software.
The model can derive from the reality, each time the <code>cpu-error-threshold</code> is
reached it learn a new power model, using the previous reports.</p>
<p>The choice of those specific metrics is motivated in <a href="https://hal.inria.fr/hal-02470128">SmartWatts: Self-Calibrating
Software-Defined Power Meter for Containers</a></p>
<h1 id="installation-1"><a class="header" href="#installation-1">Installation</a></h1>
<p>You can use <a href="./script/smartwatts_install.sh">the following script</a> to install Smartwatts and HWPC Sensor.</p>
<h2 id="from-pypi-1"><a class="header" href="#from-pypi-1">From pypi</a></h2>
<p><code>pip install smartwatts</code></p>
<h2 id="from-docker-1"><a class="header" href="#from-docker-1">From docker</a></h2>
<p><code>docker pull powerapi/smartwatts-formula</code></p>
<h2 id="from-deb-file-1"><a class="header" href="#from-deb-file-1">From deb file</a></h2>
<p>Download the <code>.deb</code> file from the <a href="https://github.com/powerapi-ng/smartwatts-formula/releases">latest
release</a></p>
<p>Install smartwatts with <code>sudo apt install ./python3-smartwatts_0.8.0-1_all.deb</code></p>
<h1 id="quickstart-1"><a class="header" href="#quickstart-1">Quickstart</a></h1>
<p>For running the Smartwatts formula we'll need two things:</p>
<ul>
<li>A sensor that provide HWPCReport. We'll use <a href="./hwpc-sensor.html">HWPC sensor</a>.</li>
<li>A configuration for the formula. We provide an example bellow.</li>
</ul>
<pre><code class="language-json">{
  &quot;verbose&quot;: true,
  &quot;stream&quot;: true,
  &quot;input&quot;: {
    &quot;puller&quot;: {
      &quot;model&quot;: &quot;HWPCReport&quot;,
      &quot;type&quot;: &quot;mongodb&quot;,
      &quot;uri&quot;: &quot;mongodb://127.0.0.1&quot;,
      &quot;db&quot;: &quot;test&quot;,
      &quot;collection&quot;: &quot;prep&quot;
    }
  },
  &quot;output&quot;: {
    &quot;pusher_power&quot;: {
      &quot;type&quot;: &quot;mongodb&quot;,
      &quot;uri&quot;: &quot;mongodb://127.0.0.1&quot;,
      &quot;db&quot;: &quot;test&quot;,
      &quot;collection&quot;: &quot;prep&quot;
    }
  },
  &quot;cpu-frequency-base&quot;: 19,
  &quot;cpu-frequency-min&quot;: 4,
  &quot;cpu-frequency-max&quot;: 42,
  &quot;cpu-error-threshold&quot;: 2.0,
  &quot;disable-dram-formula&quot;: true,
  &quot;sensor-report-sampling-interval&quot;: 1000
}
</code></pre>
<p>The configuration can depend of your hardware, we provide an <a href="./smartwatts_auto_config.html">auto-configuration
script</a>.</p>
<p>Start by installing the hwpc-sensor (see
<a href="./hwpc-sensor.html#installation">here</a>) and start it (see
<a href="./hwpc-sensor.html#quickstart">here</a>).
You also need to start an mongodb via the command line <code>docker run -d --name mongo_sw -p 27017:27017 mongo</code>.</p>
<p>Then run <code>smartwatts</code> using one of the following command line, depending on
the installation you used:</p>
<ul>
<li>via pip : <code>python -m smartwatts --config-file config_file.json</code></li>
<li>via docker <code>docker run -v $(pwd)/config_file.json:/config_file.json powerapi/smartwatts-formula --config-file /config_file.json </code></li>
<li>via deb file : <code>smartwatts --config-file confgi_file.json</code></li>
</ul>
<p>Your power report will be provided in the influxdb. You can watch them in a
grafana using the <a href="./grafana.html">following tutorial</a></p>
<h1 id="auto-config-script"><a class="header" href="#auto-config-script">Auto-config Script</a></h1>
<p>This script detect the frequency of your cpu and use them to provide a
configuration file for Smartwatts.</p>
<pre><code class="language-sh">#!/usr/bin/env bash

maxfrequency=$(lscpu -b -p=MAXMHZ | tail -n -1| cut -d , -f 1)
minfrequency=$(lscpu -b -p=MINMHZ | tail -n -1 | cut -d , -f 1)
basefrequency=$(lscpu | grep &quot;Model name&quot; | cut -d @ -f 2 | cut -d G -f 1)
basefrequency=$(expr ${basefrequency}\*1000 | bc | cut -d . -f 1)

echo &quot;
{
  &quot;verbose&quot;: true,
  &quot;stream&quot;: true,
  &quot;input&quot;: {
    &quot;puller&quot;: {
      &quot;model&quot;: &quot;HWPCReport&quot;,
      &quot;type&quot;: &quot;socket&quot;,
      &quot;uri&quot;: &quot;127.0.0.1&quot;,
      &quot;port&quot;: 8080,
      &quot;collection&quot;: &quot;test_hwpc&quot;
    }
  },
  &quot;output&quot;: {
    &quot;pusher_power&quot;: {
      &quot;type&quot;: &quot;influxdb&quot;,
      &quot;model&quot;: &quot;PowerReport&quot;,
      &quot;uri&quot;: &quot;127.0.0.1&quot;,
      &quot;port&quot;: 8086,
      &quot;db&quot;: &quot;test&quot;,
      &quot;collection&quot;: &quot;prep&quot;
    }
  },
  &quot;cpu-ratio-base&quot;: $basefrequency,
  &quot;cpu-ratio-min&quot;: $minfrequency,
  &quot;cpu-ratio-max&quot;: $maxfrequency,
  &quot;cpu-error-threshold&quot;: 2.0,
  &quot;disable-dram-formula&quot;: true,
  &quot;sensor-report-sampling-interval&quot;: 1000
}
&quot; &gt; ./config_file.json

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jouleit-1"><a class="header" href="#jouleit-1">Jouleit</a></h1>
<p>Jouleit is a script that can be used to monitor energy consumption for any program.</p>
<p>Jouleit uses the Intel &quot;Running Average Power Limit&quot; (RAPL) technology that
estimates power consumption of the CPU, ram and integrated GPU. This technology
is available on Intel CPU since the Sandy Bridge generation(2010).</p>
<h2 id="installation-2"><a class="header" href="#installation-2">Installation</a></h2>
<p>Jouleit need <code>gawk</code> to run.
You can get the script from the <a href="https://github.com/powerapi-ng/jouleit">github repository</a>
Start jouleit by using <code>./jouleit.sh cmd</code>.</p>
<h2 id="flags-and-options"><a class="header" href="#flags-and-options">Flags and options</a></h2>
<table><thead><tr><th><strong>Flag</strong></th><th><strong>Description</strong></th><th style="text-align: center"><strong>Default value</strong></th></tr></thead><tbody>
<tr><td>-a</td><td>print the details of all sockets instead of the aggregation</td><td style="text-align: center">False</td></tr>
<tr><td>-b</td><td>print the results in the format of *KEY1;VALUE1;KEY2;VALUE2..</td><td style="text-align: center">False</td></tr>
<tr><td>-l</td><td>list all the available domaines ( CPU, DRAM ..etc ) and print them in the form of a header of csv</td><td style="text-align: center"></td></tr>
<tr><td>-c</td><td>Print only the values in csv format ( value1;value2;value3), We recommend using this after running the <strong>jouleit</strong> with -l Flag to see the order of the measured values</td><td style="text-align: center">false</td></tr>
<tr><td>-s <strong>#N</strong></td><td>measure only the energy of the socket <strong>#N</strong></td><td style="text-align: center">all the available sockets</td></tr>
<tr><td>-o <strong>filename</strong></td><td>redirect the output and the log of the executed program in the file `filename</td><td style="text-align: center">current terminal</td></tr>
<tr><td>-n <strong>N</strong></td><td>Run the programm <strong>N</strong> times and record the measured values in <code>data1234.csv</code> file</td><td style="text-align: center"></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="virtualwatts"><a class="header" href="#virtualwatts">VirtualWatts</a></h1>
<p>VirtualWatts is a software-defined power meter based on the PowerAPI toolkit.
VirtualWatts is a configurable software that can estimate the power consumption
of software inside a Virtual Machine (VM) in real-time.</p>
<p>VirtualWatts use the estimation of energy consumption of the VM, computed by
<a href="https://github.com/powerapi-ng/smartwatts">SmartWatts</a>, and the cpu usage of
each process inside the VM, computed by <a href="https://github.com/powerapi-ng/procfs-sensor">Procfs
Sensor</a>.</p>
<h1 id="installation-3"><a class="header" href="#installation-3">Installation</a></h1>
<p>You can use <a href="./script/virtualwatts_install.sh">the following script</a> to install VirtualWatts and Procfs Sensor.</p>
<h2 id="from-pypi-2"><a class="header" href="#from-pypi-2">From pypi</a></h2>
<p><code>pip install virtualwatts</code></p>
<h2 id="from-docker-2"><a class="header" href="#from-docker-2">From docker</a></h2>
<p><code>docker pull powerapi/virtualwatts-formula</code></p>
<h2 id="from-deb-file-2"><a class="header" href="#from-deb-file-2">From deb file</a></h2>
<p>Download the <code>.deb</code> file from the <a href="https://github.com/powerapi-ng/virtualwatts-formula/releases">latest
release</a></p>
<p>Install virtualwatts with <code>sudo apt install ./python3-virtualtwatts_0.1.1-1_all.deb</code></p>
<h1 id="quickstart-2"><a class="header" href="#quickstart-2">Quickstart</a></h1>
<p>For running the VirtualWatts formula we'll need several things:</p>
<ul>
<li>Smartwatts running on the host machine</li>
<li>A file <code>SW_output</code>, shared with the host that will be used as database</li>
<li>The Procfs sensor running inside the VM</li>
<li>A configuration file for each.</li>
</ul>
<p>VirtualWatts configuration :</p>
<pre><code class="language-json">{
    'verbose': True,
    &quot;stream&quot;:True,
    &quot;input&quot;: {
        &quot;puller_filedb&quot;: {
            &quot;type&quot;: &quot;filedb&quot;,
            &quot;model&quot;: &quot;PowerReport&quot;,
            &quot;filename&quot;: &quot;SW_output&quot;
            },
        &quot;puller_tcpdb&quot;: {
            &quot;type&quot; : &quot;socket&quot;,
            &quot;model&quot;: &quot;ProcfsReport&quot;,
            &quot;uri&quot;: &quot;127.0.0.1&quot;,
            &quot;port&quot;: self.port
        }
    },
    &quot;output&quot;: {
        &quot;power_pusher&quot;: {
        &quot;type&quot;: &quot;influxdb&quot;,
        &quot;model&quot;: &quot;PowerReport&quot;,
        &quot;uri&quot;: &quot;127.0.0.1&quot;,
        &quot;port&quot;: 8086,
        &quot;db&quot;: &quot;test&quot;,
        &quot;collection&quot;: &quot;prep&quot;
        }
    },
    &quot;delay-threshold&quot;: 500,
    &quot;sensor-reports-sampling-interval&quot;: datetime.timedelta(500)
}
</code></pre>
<p>Start by running Smartwatts with a <code>filedb</code> output.
Then run <code>virtualwatts</code> using one of the following command line, depending on
the installation you used:</p>
<ul>
<li>via pip : <code>python -m virtualwatts --config-file config_file.json</code></li>
<li>via docker <code>docker run -v $(pwd)/config_file.json:/config_file.json powerapi/virtualwatts --config-file /config_file.json </code></li>
<li>via deb file : <code>virtualwatts --config-file config_file.json</code></li>
</ul>
<p>After that run the procfs sensor. Your power report will be provided in the influxdb. You can watch them in a
grafana using the <a href="./grafana.html">following tutorial</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hwpc-sensor"><a class="header" href="#hwpc-sensor">Hwpc-Sensor</a></h1>
<p>HardWare Performance Counter (HWPC) Sensor is a tool that monitor the Intel CPU
performance counter and the power consumption of CPU.</p>
<p>Hwpc-sensor use the RAPL (Running Average Power Limit) technology to monitor CPU
power consumption. This technology is only available on Intel Sandy Bridge
architecture or higher.</p>
<p>The sensor use the perf API of the Linux kernel. It is only available on Linux
and need to have root access to be used.</p>
<p>The sensor couldn’t be used in a virtual machine, it must access (via Linux
kernel API) to the real CPU register to read performance counter values.</p>
<h1 id="installation-4"><a class="header" href="#installation-4">Installation</a></h1>
<h2 id="from-docker-3"><a class="header" href="#from-docker-3">From docker</a></h2>
<p><code>docker pull powerapi/hwpc-sensor</code></p>
<h2 id="from-deb-file-3"><a class="header" href="#from-deb-file-3">From deb file</a></h2>
<p>Download the <code>.deb</code> file from the <a href="https://github.com/powerapi-ng/hwpc-sensor/releases">latest
release</a></p>
<p>Install the sensor with <code>sudo apt install hwpc-sensor-1.1.0.deb</code></p>
<h2 id="using-the-binary"><a class="header" href="#using-the-binary">Using the binary</a></h2>
<p>You can use the compiled version of the sensor (available
<a href="https://github.com/powerapi-ng/hwpc-sensor/releases">here</a>)</p>
<h1 id="quickstart-3"><a class="header" href="#quickstart-3">Quickstart</a></h1>
<p>For running the sensor, first we need a configuration. We provide an example bellow.</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;sensor&quot;,
  &quot;verbose&quot;: true,
  &quot;frequency&quot;: 500,
  &quot;output&quot;: {
    &quot;type&quot;: &quot;mongodb&quot;,
    &quot;uri&quot;: &quot;mongodb://127.0.0.1&quot;,
    &quot;database&quot;: &quot;db_sensor&quot;,
    &quot;collection&quot;: &quot;report_0&quot;
  },
  &quot;system&quot;: {
    &quot;rapl&quot;: {
      &quot;events&quot;: [&quot;RAPL_ENERGY_PKG&quot;],
      &quot;monitoring_type&quot;: &quot;MONITOR_ONE_CPU_PER_SOCKET&quot;
    },
    &quot;msr&quot;: {
      &quot;events&quot;: [&quot;TSC&quot;, &quot;APERF&quot;, &quot;MPERF&quot;]
    }
  },
  &quot;container&quot;: {
    &quot;core&quot;: {
      &quot;events&quot;: [
        &quot;CPU_CLK_THREAD_UNHALTED:REF_P&quot;,
        &quot;CPU_CLK_THREAD_UNHALTED:THREAD_P&quot;,
        &quot;LLC_MISSES&quot;,
        &quot;INSTRUCTIONS_RETIRED&quot;
      ]
    }
  }
}
</code></pre>
<p>Start a mongo db and then you can start the sensor with the following command line, depending on your
installation :</p>
<ul>
<li>from docker : <code>docker run --rm --net=host --privileged --pid=host -v /sys:/sys -v /var/lib/docker/containers:/var/lib/docker/containers:ro -v /tmp/powerapi-sensor-reporting:/reporting -v $(pwd):/srv -v $(pwd)/config_file.json:/config_file.json powerapi/hwpc-sensor --config-file /config_file.json </code></li>
<li>from binary : <code>./hwpc-sensor --config-file config_file.json</code></li>
</ul>
<p>The reports will be provided in your mongodb.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="procfs-sensor"><a class="header" href="#procfs-sensor">Procfs-Sensor</a></h1>
<p>The Proc Filesystem Sensor is a tool that monitor the CPU usage of cgroup via
the linux's proc filesystem.
It use <code>pidstat</code> to retreive the percentage of CPU usage of each process.
It then use the <code>/sys/fs/perf_event</code> directory to find the appartenance of
processes to cgroup.</p>
<p>The sensor need the cgroup version 1. The version 2 is not supported yet.</p>
<h1 id="installation-5"><a class="header" href="#installation-5">Installation</a></h1>
<h2 id="from-pypi-3"><a class="header" href="#from-pypi-3">From pypi</a></h2>
<p><code>pip install procfs-sensor</code></p>
<h2 id="from-docker-4"><a class="header" href="#from-docker-4">From docker</a></h2>
<p><code>docker pull powerapi/procfs-sensor</code></p>
<h2 id="from-deb-file-4"><a class="header" href="#from-deb-file-4">From deb file</a></h2>
<p>Download the <code>.deb</code> file from the <a href="https://github.com/powerapi-ng/procfs-sensor/releases">latest
release</a></p>
<p>Install the sensor with <code>sudo apt install procfs-sensor-1.1.0.deb</code></p>
<h2 id="using-the-binary-1"><a class="header" href="#using-the-binary-1">Using the binary</a></h2>
<p>You can use the compiled version of the sensor (available
<a href="https://github.com/powerapi-ng/procfs-sensor/releases">here</a>)</p>
<h1 id="quickstart-4"><a class="header" href="#quickstart-4">Quickstart</a></h1>
<p>For running the sensor, first you need to define the cgroup you want to track.</p>
<p>The for running the sensor you need configuration. We provide an example bellow.</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;procfs_sensor&quot;,
  &quot;verbose&quot;: true,
  &quot;frequency&quot;: 500,
  &quot;output&quot;: {
    &quot;type&quot;: &quot;socket&quot;,
    &quot;uri&quot;: &quot;127.0.0.1&quot;,
    &quot;port&quot;: 8080
  },
  &quot;target&quot;: [&quot;cgroup1&quot;, &quot;cgroup2&quot;, ...]
}
</code></pre>
<p>You can start the sensor with the following command line, depending on your installation :</p>
<ul>
<li>from docker : ``docker -v ./config_file.json:/config_file.json run procfs-sensor --config_file config_file.json`</li>
<li>from pip : <code>python -m procfs-sensor --config-file config_file.json</code></li>
</ul>
<p>You can use a TCP server to retreive the reports.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database"><a class="header" href="#database">Database</a></h1>
<p>A database can be used as an input or an output of powerapi formula</p>
<p>For each database the parameters to specify are differents. For each database,
its parameters are specified in its section.</p>
<h2 id="mongodb"><a class="header" href="#mongodb">MongoDB</a></h2>
<p>If you want to use a mongo database in your formula your have to specify
<code>mongodb</code> as the <code>type</code> of a puller or a pusher.</p>
<p>The list of parameters you have to provide :</p>
<ul>
<li><code>uri</code> : The ip address of your mongo database</li>
<li><code>db</code>: the name of your database</li>
<li><code>collection</code>: the name of the collection inside the database</li>
</ul>
<p>The default <code>model</code> of <code>mongodb</code> is <code>HWPCReport</code> if used as an input and
<code>PowerReport</code> if used as an output.</p>
<p>We provide an example of configuration file.</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;mongodb&quot;,
  &quot;uri&quot;: &quot;mongodb://127.0.0.1&quot;,
  &quot;db&quot;: &quot;test&quot;,
  &quot;collection&quot;: &quot;prep&quot;
}
</code></pre>
<h2 id="influx-db"><a class="header" href="#influx-db">Influx DB</a></h2>
<p>If you want to use an influxdb in your formula your have to specify
<code>influxedb</code> as the <code>type</code> of a puller or a pusher.</p>
<p>The list of parameters you have to provide :</p>
<ul>
<li><code>uri</code> : IP address of the server with the database</li>
<li><code>port</code>: port of communication</li>
<li><code>db</code> : name of the database</li>
</ul>
<p>InfluxDB can only be used as an output and its default <code>model</code> is <code>PowerReport</code>.</p>
<p>We provide an example of configuration file.</p>
<pre><code class="language-json">{
  &quot;tags&quot;: &quot;socket&quot;,
  &quot;model&quot;: &quot;PowerReport&quot;,
  &quot;type&quot;: &quot;influxdb&quot;,
  &quot;uri&quot;: &quot;127.0.0.1&quot;,
  &quot;port&quot;: &quot;8086&quot;,
  &quot;db&quot;: &quot;test_influxdb&quot;
}
</code></pre>
<h2 id="csv"><a class="header" href="#csv">CSV</a></h2>
<p>If you want to use a csv file in your formula your have to specify
<code>csv</code> as the <code>type</code> of a puller or a pusher.</p>
<p>The list of parameters you have to provide :</p>
<ul>
<li><code>uri</code> : The csv file name</li>
</ul>
<p>The default <code>model</code> of <code>csv</code> is <code>HWPCReport</code>.</p>
<p>The default <code>model</code> of <code>csv</code> is <code>HWPCReport</code> if used as an input and
<code>PowerReport</code> if used as an output.</p>
<p>We provide an example of configuration file.</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;csv&quot;,
  &quot;uri&quot;: &quot;/tmp/sensor_output/&quot;
}
</code></pre>
<h2 id="socket"><a class="header" href="#socket">Socket</a></h2>
<p>If you want to use a tcp socket in your formula your have to specify
<code>socket</code> as the <code>type</code> of a puller or a pusher.
This database is made for stream mode.</p>
<p>The list of parameters you have to provide :</p>
<ul>
<li><code>uri</code> : The IP address of the server</li>
<li><code>port</code>: The port to use to communicate with the server</li>
</ul>
<p>The socket can only be used as an input and its default <code>model</code> is <code>HWPCReport</code>.</p>
<p>We provide an example of configuration file.</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;socket&quot;,
  &quot;uri&quot;: &quot;127.0.0.1&quot;,
  &quot;port&quot;: 8080
}
</code></pre>
<h2 id="file-database"><a class="header" href="#file-database">File Database</a></h2>
<p>If you want to use a file as database in your formula your have to specify
<code>filedb</code> as the <code>type</code> of a puller or a pusher.
The database is made for stream mode. It should contain only the last
report.</p>
<p>The list of parameters you have to provide :</p>
<ul>
<li><code>filename</code> : The name of the file</li>
</ul>
<p>This database can only be used as an input and its default <code>model</code> is <code>PowerReport</code>.</p>
<p>We provide an example of configuration file.</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;socket&quot;,
  &quot;filename&quot;: /tmp/database
}
</code></pre>
<h2 id="prometheus"><a class="header" href="#prometheus">Prometheus</a></h2>
<p>If you want to use a prometheus as database in your formula your have to specify
<code>prom</code> as the <code>type</code> of a pusher.</p>
<p>The list of parameters you have to provide :</p>
<ul>
<li><code>tags</code> : specify report tags</li>
<li><code>uri</code> : Server ip address</li>
<li><code>port</code> : Server port</li>
<li><code>metric_name</code> : The metric name</li>
<li><code>metric_description</code> : The metric description. It default value is <code> energy consumption</code>
This database can only be used as an output.</li>
</ul>
<p>We provide an example of configuration file.</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;prom&quot;,
  &quot;uri&quot;: &quot;127.0.0.1&quot;,
  &quot;port&quot;: 8080,
  &quot;metric_name&quot;: test
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><img src="https://rawgit.com/Spirals-Team/powerapi/master/resources/logo/PowerAPI-logo.png" alt="Powerapi" width="300px">
<p>PowerAPI is a middleware toolkit for building software-defined power meters.
Software-defined power meters are configurable software libraries that can
estimate the power consumption of software in real-time.
As a middleware toolkit, PowerAPI offers the capability of assembling power
meters <em>«à la carte»</em> to accommodate user requirements.
If you want to build your own power meter using PowerAPI, we provide a step by
step guide.</p>
<h1 id="creating-your-own-formula"><a class="header" href="#creating-your-own-formula">Creating your own formula</a></h1>
<p>To develop a formula you have to consider the following parts :</p>
<ul>
<li>The configuration parameters needed by the actor</li>
<li>The dispatching rule of the reports to the different formula actors</li>
<li>The behavior of the formula actor</li>
</ul>
<p>We provide a <a href="https://github.com/powerapi-ng/dummy-formula">dummy formula</a> that
contain the template to develop your own formula.
Next we provide a guide on developing your own formula using that template.</p>
<h2 id="starting"><a class="header" href="#starting">Starting</a></h2>
<p>To develop a formula there is two major tasks. How to handle the formula actor,
and the behavior of the formula actor.</p>
<p>The first thing you need to decide is what will your formula receive as
inputs, how it will treat it and what will it return.
Once you've decide this part you need to extract the parameters needed by the
formula actor.
In the next of this guide we will treat the handling of the formula actor then
we will provide some advices on how to develop your formula actor.</p>
<h2 id="handling-the-actor"><a class="header" href="#handling-the-actor">Handling the actor</a></h2>
<p>Once you've decided the parameters the formula actor will need, we need to build
the chain to pass them from the configuration file to the actor.</p>
<p>First we need to build the parser that will extract the parameters from the
configuration file.
For that part we are working on <code>generate_dummy_parser</code> in <code>__main__.py</code>.
For each parameters <code>arg</code> you should add the following lines :</p>
<pre><code class="language-python">    parser.add_argument(
        &quot;arg&quot;,  # name of the arg
        help=&quot;help on arg&quot;,  # help to display when --help is used
        type=None,  # type expected
        default=None,  # Default value if not specified
    )
</code></pre>
<p>Once the configuration is retrieved from the configuration file it is necessary
to check it.
For that we use a <code>DummyConfigValidator</code> that will check that each mandatory
arguments are present and that each arguments have the correct type.</p>
<p>At this moment the configuration is a Dictionary, it will be transformed to a
<code>DummyFormulaConfig</code> (in <code>context.py</code>) to be passed to the actor.
You should put each parameters needed in the formula actor as attribute of that
class.</p>
<p>In addition of the configuration you need to specify the dispatch rule of
<code>route_table</code>. This rule decide which report is send to which formula actor.
If you choose SENSOR, reports with the same sensor field will be send to the
same actor. If you choose SOCKET the sort will be made on the <code>sensor</code> field.</p>
<h2 id="your-formula"><a class="header" href="#your-formula">Your formula</a></h2>
<p>Now that you actor will receive its parameters, you need to build it.
Your actor will be initialized two times, one as an object and one as an actor.
You first need to define all the attributes as <code>None</code> is the <code>__init__</code>.
The supervisor will then call <code> _initialization</code> with a <code>StartMessage</code>
containing the configuration.</p>
<p>The <code>receiveMsg_Report(self,message)</code> method will be used each time a report is
send to the formula actor.
Once you have treated your reports and produced the output reports, send them
to the pushers using the following commands :</p>
<pre><code class="language-python">for name, pusher in self.pushers.items():
    self.log_debug('send ' + str(report) + ' to ' + name)
    self.send(pusher, report)
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
